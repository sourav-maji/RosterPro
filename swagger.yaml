openapi: 3.0.3
info:
  title: SmartShift / RosterPro API
  version: "1.0.0"
  description: >
    Backend APIs for multi-tenant rostering system with ML scheduling

servers:
  - url: http://localhost:3000/api/v1

security:
  - bearerAuth: []

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    ApiResponse:
      type: object
      properties:
        success: { type: boolean }
        message: { type: string }
        data: { type: object }

    IdParam:
      type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string }

    Organization:
      type: object
      properties:
        name: { type: string }
        contactEmail: { type: string }
        type:
          type: string
          enum: [HOSPITAL, FACTORY, GENERIC]

    User:
      type: object
      properties:
        name: { type: string }
        email: { type: string }
        roleId: { type: string }
        departmentId: { type: string }

    Department:
      type: object
      properties:
        name: { type: string }
        description: { type: string }

    Shift:
      type: object
      properties:
        name: { type: string }
        startTime: { type: string }
        endTime: { type: string }
        durationHours: { type: number }

    ShiftRequirement:
      type: object
      properties:
        departmentId: { type: string }
        shiftId: { type: string }
        roleId: { type: string }
        requiredCount: { type: integer }
        effectiveFrom: { type: string, format: date }
        effectiveTo: { type: string, format: date }

    SchedulerRequest:
      type: object
      properties:
        departmentId: { type: string }
        date: { type: string, format: date }

paths:

  # ================= AUTH =================

  /auth/login:
    post:
      tags: [Auth]
      summary: Login
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200": { description: success }

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh token
      responses:
        "200": { description: success }

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout
      responses:
        "200": { description: success }


  # ================= ORGANIZATION =================

  /org:
    get:
      tags: [Organization]
      summary: List organizations
      responses: { "200": { description: ok } }

    post:
      tags: [Organization]
      summary: Create organization
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Organization"
      responses: { "200": { description: ok } }

  /org/{id}:
    put:
      tags: [Organization]
      summary: Update organization
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }


  # ================= USERS =================

  /users:
    get:
      tags: [Users]
      summary: List users
      responses: { "200": { description: ok } }

    post:
      tags: [Users]
      summary: Create user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses: { "200": { description: ok } }

  /users/count:
    get:
      tags: [Users]
      summary: Count users
      responses: { "200": { description: ok } }

  /users/{id}:
    get:
      tags: [Users]
      summary: Get user by id
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    put:
      tags: [Users]
      summary: Update user
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    delete:
      tags: [Users]
      summary: Delete user
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  /users/toggle/{id}:
    post:
      tags: [Users]
      summary: Toggle active
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }


  # ================= DEPARTMENTS =================

  /departments:
    get:
      tags: [Departments]
      summary: List departments
      responses: { "200": { description: ok } }

    post:
      tags: [Departments]
      summary: Create department
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Department"
      responses: { "200": { description: ok } }

  /departments/{id}:
    put:
      tags: [Departments]
      summary: Update department
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    delete:
      tags: [Departments]
      summary: Delete department
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  /departments/{id}/users:
    get:
      tags: [Departments]
      summary: Users of department
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }


  # ================= SHIFTS =================

  /shifts:
    get:
      tags: [Shifts]
      summary: List shifts
      responses: { "200": { description: ok } }

    post:
      tags: [Shifts]
      summary: Create shift
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Shift"
      responses: { "200": { description: ok } }

  /shifts/{id}:
    put:
      tags: [Shifts]
      summary: Update shift
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    delete:
      tags: [Shifts]
      summary: Delete shift
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }


  # ================= SHIFT REQUIREMENT =================

  /shift-req:
    get:
      tags: [Shift Requirement]
      summary: List all requirements
      responses: { "200": { description: ok } }

    post:
      tags: [Shift Requirement]
      summary: Create requirement
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShiftRequirement"
      responses: { "200": { description: ok } }

  /shift-req/bulk:
    post:
      tags: [Shift Requirement]
      summary: Bulk upsert
      responses: { "200": { description: ok } }

  /shift-req/{id}:
    put:
      tags: [Shift Requirement]
      summary: Update requirement
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    delete:
      tags: [Shift Requirement]
      summary: Delete requirement
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  /shift-req/department/{deptId}:
    get:
      tags: [Shift Requirement]
      summary: By department
      parameters:
        - name: deptId
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  /shift-req/department/{deptId}/shift/{shiftId}:
    get:
      tags: [Shift Requirement]
      summary: Particular shift of department
      parameters:
        - name: deptId
          in: path
          required: true
          schema: { type: string }
        - name: shiftId
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }


  # ================= SCHEDULER =================

  /scheduler/preview:
    post:
      tags: [Scheduler]
      summary: Generate ML schedule
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SchedulerRequest"
      responses: { "200": { description: ok } }

  /scheduler/save:
    post:
      tags: [Scheduler]
      summary: Save ML result
      responses: { "200": { description: ok } }


  # ================= ALLOCATION =================

  /alloc:
    get:
      tags: [Allocation]
      summary: List allocations
      parameters:
        - name: departmentId
          in: query
          schema: { type: string }
        - name: date
          in: query
          schema: { type: string, format: date }
      responses: { "200": { description: ok } }

  /alloc/manual:
    post:
      tags: [Allocation]
      summary: Manual assign
      responses: { "200": { description: ok } }

  /alloc/ml:
    post:
      tags: [Allocation]
      summary: Save from ML
      responses: { "200": { description: ok } }

  /alloc/swap:
    post:
      tags: [Allocation]
      summary: Swap user
      responses: { "200": { description: ok } }

  /alloc/{id}:
    delete:
      tags: [Allocation]
      summary: Delete allocation
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  /alloc/board:
    get:
      tags: [Allocation]
      summary: Department board
      parameters:
        - name: departmentId
          in: query
          schema: { type: string }
        - name: date
          in: query
          schema: { type: string, format: date }
      responses: { "200": { description: ok } }

  /alloc/calendar:
    get:
      tags: [Allocation]
      summary: User calendar
      parameters:
        - name: userId
          in: query
          schema: { type: string }
        - name: from
          in: query
          schema: { type: string, format: date }
        - name: to
          in: query
          schema: { type: string, format: date }
      responses: { "200": { description: ok } }

  /alloc/coverage:
    get:
      tags: [Allocation]
      summary: Requirement vs actual
      parameters:
        - name: departmentId
          in: query
          schema: { type: string }
        - name: date
          in: query
          schema: { type: string, format: date }
      responses: { "200": { description: ok } }
