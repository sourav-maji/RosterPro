openapi: 3.0.4
info:
  title: SmartShift / RosterPro API
  version: "1.0.0"
  description: >
    Backend APIs for multi-tenant rostering system with ML scheduling

servers:
  - url: http://localhost:3000/api/v1

security:
  - bearerAuth: []

components:

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:

    ApiResponse:
      type: object
      properties:
        success: { type: boolean }
        message: { type: string }
        data: { type: object }

    # ---------- AUTH ----------
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string }

    # ---------- MASTERS ----------
    Organization:
      type: object
      properties:
        name: { type: string }
        contactEmail: { type: string }
        type:
          type: string
          enum: [HOSPITAL, FACTORY, GENERIC]

    User:
      type: object
      properties:
        name: { type: string }
        email: { type: string }
        roleId: { type: string }
        departmentId: { type: string }

    Department:
      type: object
      properties:
        name: { type: string }
        description: { type: string }

    Shift:
      type: object
      properties:
        name: { type: string }
        startTime: { type: string }
        endTime: { type: string }
        durationHours: { type: number }

    ShiftRequirement:
      type: object
      properties:
        departmentId: { type: string }
        shiftId: { type: string }
        roleId: { type: string }
        requiredCount: { type: integer }
        effectiveFrom: { type: string, format: date }
        effectiveTo: { type: string, format: date }

    SchedulerRequest:
      type: object
      properties:
        departmentId: { type: string }
        date: { type: string, format: date }

    # ---------- RBAC ----------
    PermissionCreate:
      type: object
      required: [code, name]
      properties:
        code:
          type: string
          example: USER_VIEW
        name:
          type: string
          example: View Users
        module:
          type: string
          example: CORE

    RoleCreate:
      type: object
      required: [code, name]
      properties:
        code:
          type: string
          example: MANAGER
        name:
          type: string
          example: Department Manager
        organizationId:
          type: string

    RolePermissionAssign:
      type: object
      required: [roleId, permissionId]
      properties:
        roleId: { type: string }
        permissionId: { type: string }

    RolePermissionBulk:
      type: object
      required: [roleId, permissionIds]
      properties:
        roleId: { type: string }
        permissionIds:
          type: array
          items: { type: string }

    Error403:
      type: object
      properties:
        success: { type: boolean, example: false }
        message: { type: string, example: Permission denied }

paths:

  # ================= AUTH =================
  /auth/login:
    post:
      tags: [Auth]
      summary: Login
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200": { description: success }

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Refresh token
      responses: { "200": { description: success } }

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout
      responses: { "200": { description: success } }

  # ================= ORGANIZATION =================
  /org:
    get:
      tags: [Organization]
      summary: List organizations
      responses: { "200": { description: ok } }

    post:
      tags: [Organization]
      summary: Create organization
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Organization"
      responses: { "200": { description: ok } }

  /org/{id}:
    put:
      tags: [Organization]
      summary: Update organization
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  # ================= USERS =================
  /users:
    get:
      tags: [Users]
      summary: List users
      responses: { "200": { description: ok } }

    post:
      tags: [Users]
      summary: Create user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/User"
      responses: { "200": { description: ok } }

  /users/count:
    get:
      tags: [Users]
      summary: Count users
      responses: { "200": { description: ok } }

  /users/{id}:
    get:
      tags: [Users]
      summary: Get user
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    put:
      tags: [Users]
      summary: Update user
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    delete:
      tags: [Users]
      summary: Delete user
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  /users/toggle/{id}:
    post:
      tags: [Users]
      summary: Toggle active
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

  # ================= DEPARTMENTS =================
  /departments:
    get:
      tags: [Departments]
      responses: { "200": { description: ok } }

    post:
      tags: [Departments]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Department"
      responses: { "200": { description: ok } }

  /departments/{id}:
    put:
      tags: [Departments]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses: { "200": { description: ok } }

    delete:
      tags: [Departments]
      parameters:
        - name: id
          in: path
          required: true
      responses: { "200": { description: ok } }

  /departments/{id}/users:
    get:
      tags: [Departments]
      responses: { "200": { description: ok } }

  # ================= SHIFTS =================
  /shifts:
    get:
      tags: [Shifts]
      responses: { "200": { description: ok } }

    post:
      tags: [Shifts]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Shift"
      responses: { "200": { description: ok } }

  /shifts/{id}:
    put:
      tags: [Shifts]
      parameters:
        - name: id
          in: path
      responses: { "200": { description: ok } }

    delete:
      tags: [Shifts]
      parameters:
        - name: id
          in: path
      responses: { "200": { description: ok } }

  # ================= SHIFT REQUIREMENT =================
  /shift-req:
    get:
      tags: [Shift Requirement]
      responses: { "200": { description: ok } }

    post:
      tags: [Shift Requirement]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShiftRequirement"
      responses: { "200": { description: ok } }

  /shift-req/bulk:
    post:
      tags: [Shift Requirement]
      responses: { "200": { description: ok } }

  /shift-req/{id}:
    put:
      tags: [Shift Requirement]
      responses: { "200": { description: ok } }

    delete:
      tags: [Shift Requirement]
      responses: { "200": { description: ok } }

  /shift-req/department/{deptId}:
    get:
      tags: [Shift Requirement]
      responses: { "200": { description: ok } }

  /shift-req/department/{deptId}/shift/{shiftId}:
    get:
      tags: [Shift Requirement]
      responses: { "200": { description: ok } }

  # ================= RBAC MODULES =================

  /permissions:
    post:
      tags: [Permissions]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PermissionCreate"
      responses:
        "200": { description: ok }
        "403":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error403"

    get:
      tags: [Permissions]
      responses: { "200": { description: ok } }

  /permissions/{id}:
    put:
      tags: [Permissions]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PermissionCreate"
      responses: { "200": { description: ok } }

  /roles:
    post:
      tags: [Roles]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RoleCreate"
      responses: { "200": { description: ok } }

    get:
      tags: [Roles]
      responses: { "200": { description: ok } }

  /roles/{id}:
    put:
      tags: [Roles]
      responses: { "200": { description: ok } }

    delete:
      tags: [Roles]
      responses: { "200": { description: ok } }

  /role-permission:
    post:
      tags: [RolePermission]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RolePermissionAssign"
      responses: { "200": { description: ok } }

  /role-permission/bulk:
    post:
      tags: [RolePermission]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RolePermissionBulk"
      responses: { "200": { description: ok } }

  /role-permission/{id}:
    delete:
      tags: [RolePermission]
      responses: { "200": { description: ok } }

  /role-permission/role/{roleId}:
    get:
      tags: [RolePermission]
      responses: { "200": { description: ok } }

  # ================= SCHEDULER =================
  /scheduler/preview:
    post:
      tags: [Scheduler]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SchedulerRequest"
      responses: { "200": { description: ok } }

  /scheduler/save:
    post:
      tags: [Scheduler]
      responses: { "200": { description: ok } }

  # ================= ALLOCATION =================
  /alloc:
    get:
      tags: [Allocation]
      parameters:
        - name: departmentId
          in: query
        - name: date
          in: query
      responses: { "200": { description: ok } }

  /alloc/manual:
    post:
      tags: [Allocation]
      responses: { "200": { description: ok } }

  /alloc/ml:
    post:
      tags: [Allocation]
      responses: { "200": { description: ok } }

  /alloc/swap:
    post:
      tags: [Allocation]
      responses: { "200": { description: ok } }

  /alloc/{id}:
    delete:
      tags: [Allocation]
      responses: { "200": { description: ok } }

  /alloc/board:
    get:
      tags: [Allocation]
      responses: { "200": { description: ok } }

  /alloc/calendar:
    get:
      tags: [Allocation]
      responses: { "200": { description: ok } }

  /alloc/coverage:
    get:
      tags: [Allocation]
      responses: { "200": { description: ok } }
